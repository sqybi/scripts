"
" ==========
" = Vundle =
" ==========
"

set nocompatible              " be iMproved, required
filetype off                  " required

" set the runtime path to include Vundle and initialize
set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()

" let Vundle manage Vundle, required
Plugin 'VundleVim/Vundle.vim'

" Plugins
Plugin 'ervandew/supertab'
Plugin 'bling/vim-airline'
Plugin 'altercation/vim-colors-solarized.git'
Plugin 'scrooloose/nerdtree'
Plugin 'Valloric/YouCompleteMe'
Plugin 'rhysd/vim-clang-format'

" All of your Plugins must be added before the following line
call vundle#end()            " required
filetype plugin indent on    " required

"
" =============
" = Customize =
" =============
"

" nerdtree
autocmd vimenter * NERDTree

" Relative line numbers
set relativenumber

" Use ; to find : commands history
nnoremap ; :<C-f>

" Automatically change the working path to the path of the current file
autocmd BufNewFile,BufEnter * silent! lcd %:p:h

" Set the Leader
let mapleader=','

" Alert when line is too long
function! HighlightTooLongLines()
  highlight def link RightMargin Error
  if &textwidth != 0
    exec ('match RightMargin /\%<' . (&textwidth + 3) . 'v.\%>' . (&textwidth + 1) . 'v/')
  endif
endfunction

augroup highlight_toolong
  au!
  au FileType,BufEnter * call HighlightTooLongLines()
augroup END

" Cursor line and status line for current window
autocmd WinEnter * setlocal cursorline
autocmd BufEnter * setlocal cursorline
autocmd WinLeave * setlocal nocursorline
setlocal cursorline

" DISABLE AUTOFORMATBUFFER!!!
"augroup autoformat
"  autocmd!
"  autocmd FileType bzl AutoFormatBuffer buildifier
"  autocmd FileType go AutoFormatBuffer gofmt
"  autocmd FileType proto AutoFormatBuffer clang-format
"  autocmd FileType c,cpp AutoFormatBuffer clang-format
"augroup END

" YouCompleteMe
" https://github.com/Valloric/YouCompleteMe
nnoremap <leader>yd :YcmCompleter GoToDeclaration<CR>
nnoremap <leader>yD :YcmCompleter GoToDefinition<CR>
nnoremap <leader>yt :YcmCompleter GetType<CR>
nnoremap <leader>yp :YcmCompleter GetParent<CR>

" vim-clang-format
let g:clang_format#code_style = 'google'
let g:clang_format#command = 'clang-format'
let g:clang_format#auto_format = 0
autocmd FileType c,cpp,objc nnoremap <leader>f :ClangFormat<CR>

"
" ===========
" = General =
" ===========
"

" é¢œè‰²ä¸»é¢˜
syntax on
"let g:solarized_termcolors=256
"set t_Co=256
set background=dark
"colorscheme industry
colorscheme solarized

" GVIMè®¾ç½®
if has("gui_running")
  set guifont=Dejavu\ Sans\ Mono\ 11
  set lines=60 columns=200
endif

" ä¸è¦ä½¿ç”¨viçš„é”®ç›˜æ¨¡å¼ï¼Œè€Œæ˜¯vimè‡ªå·±çš„
set nocompatible

" è‡ªåŠ¨åˆ‡æ¢ç›®å½•
set autochdir

" å»æ‰è¾“å…¥é”™è¯¯çš„æç¤ºå£°éŸ³
set noeb

" åœ¨å¤„ç†æœªä¿å­˜æˆ–åªè¯»æ–‡ä»¶çš„æ—¶å€™ï¼Œå¼¹å‡ºç¡®è®¤
set confirm

" è‡ªåŠ¨ç¼©è¿›
set autoindent
set cindent

" Tabé”®çš„å®½åº¦
set tabstop=2

" ç»Ÿä¸€ç¼©è¿›ä¸º4
set softtabstop=2
set shiftwidth=2

" ç”¨ç©ºæ ¼ä»£æ›¿åˆ¶è¡¨ç¬¦
set expandtab
autocmd Filetype html setlocal noexpandtab
autocmd Filetype javascript setlocal noexpandtab
autocmd Filetype css setlocal noexpandtab
autocmd Filetype htmldjango setlocal noexpandtab

" åœ¨è¡Œå’Œæ®µå¼€å§‹å¤„ä½¿ç”¨åˆ¶è¡¨ç¬¦
set smarttab

" æ˜¾ç¤ºè¡Œå·
set number

" å†å²è®°å½•æ•°
set history=1000

" ç¦æ­¢ç”Ÿæˆä¸´æ—¶æ–‡ä»¶
set nobackup
set noswapfile

"æœç´¢å¿½ç•¥å¤§å°å†™
set ignorecase

"æœç´¢é€å­—ç¬¦é«˜äº®
set hlsearch
set incsearch

"è¡Œå†…æ›¿æ¢
set gdefault

"ç¼–ç è®¾ç½®
set enc=utf-8
set fencs=utf-8,ucs-bom,shift-jis,gb18030,gbk,gb2312,cp936

"è¯­è¨€è®¾ç½®
set langmenu=zh_CN.UTF-8
set helplang=cn

" æˆ‘çš„çŠ¶æ€è¡Œæ˜¾ç¤ºçš„å†…å®¹ï¼ˆåŒ…æ‹¬æ–‡ä»¶ç±»å‹å’Œè§£ç ï¼‰
"set statusline=[%n]\ %F%m%r%h%w\ [%l/%L,%v][%p%%]%=[%{&ff}]\ [%Y]\ %{strftime(\"%b\ %d,\ %Y\ %H:%M\")}
"hi StatusLine term=none
"hi StatusLineNC term=none

" æ€»æ˜¯æ˜¾ç¤ºçŠ¶æ€è¡Œ
set laststatus=2

" åœ¨ç¼–è¾‘è¿‡ç¨‹ä¸­ï¼Œåœ¨å³ä¸‹è§’æ˜¾ç¤ºå…‰æ ‡ä½ç½®çš„çŠ¶æ€è¡Œ
set ruler

" å‘½ä»¤è¡Œï¼ˆåœ¨çŠ¶æ€è¡Œä¸‹ï¼‰çš„é«˜åº¦ï¼Œé»˜è®¤ä¸º1ï¼Œè¿™é‡Œæ˜¯2
set cmdheight=1

" ä¾¦æµ‹æ–‡ä»¶ç±»å‹
filetype on

" è½½å…¥æ–‡ä»¶ç±»å‹æ’ä»¶
filetype plugin on

" ä¸ºç‰¹å®šæ–‡ä»¶ç±»å‹è½½å…¥ç›¸å…³ç¼©è¿›æ–‡ä»¶
filetype indent on

" ä¿å­˜å…¨å±€å˜é‡
set viminfo+=!

" å¸¦æœ‰å¦‚ä¸‹ç¬¦å·çš„å•è¯ä¸è¦è¢«æ¢è¡Œåˆ†å‰²
set iskeyword+=_,$,@,%,#,-

" å­—ç¬¦é—´æ’å…¥çš„åƒç´ è¡Œæ•°ç›®
set linespace=0

" å¢å¼ºæ¨¡å¼ä¸­çš„å‘½ä»¤è¡Œè‡ªåŠ¨å®Œæˆæ“ä½œ
set wildmenu

" ä½¿å›æ ¼é”®ï¼ˆbackspaceï¼‰æ­£å¸¸å¤„ç†indent, eol, startç­‰
set backspace=2

" å…è®¸backspaceå’Œå…‰æ ‡é”®è·¨è¶Šè¡Œè¾¹ç•Œ
set whichwrap+=<,>,h,l

" å¯ä»¥åœ¨bufferçš„ä»»ä½•åœ°æ–¹ä½¿ç”¨é¼ æ ‡ï¼ˆç±»ä¼¼officeä¸­åœ¨å·¥ä½œåŒºåŒå‡»é¼ æ ‡å®šä½ï¼‰
set mouse=a
set selection=exclusive
set selectmode=mouse,key

" é€šè¿‡ä½¿ç”¨: commandså‘½ä»¤ï¼Œå‘Šè¯‰æˆ‘ä»¬æ–‡ä»¶çš„å“ªä¸€è¡Œè¢«æ”¹å˜è¿‡
set report=0

" å¯åŠ¨çš„æ—¶å€™ä¸æ˜¾ç¤ºé‚£ä¸ªæ´åŠ©ç´¢é©¬é‡Œå„¿ç«¥çš„æç¤º
set shortmess=atI

" åœ¨è¢«åˆ†å‰²çš„çª—å£é—´æ˜¾ç¤ºç©ºç™½ï¼Œä¾¿äºé˜…è¯»
set fillchars=vert:\ ,stl:\ ,stlnc:\ 

" é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ‹¬å·
set showmatch

" åŒ¹é…æ‹¬å·é«˜äº®çš„æ—¶é—´ï¼ˆå•ä½æ˜¯ååˆ†ä¹‹ä¸€ç§’ï¼‰
set matchtime=0

" å…‰æ ‡ç§»åŠ¨åˆ°bufferçš„é¡¶éƒ¨å’Œåº•éƒ¨æ—¶ä¿æŒè·ç¦»
set scrolloff=2

" ä¸ºCç¨‹åºæä¾›è‡ªåŠ¨ç¼©è¿›
set smartindent

" åªåœ¨ä¸‹åˆ—æ–‡ä»¶ç±»å‹è¢«ä¾¦æµ‹åˆ°çš„æ—¶å€™æ˜¾ç¤ºè¡Œå·ï¼Œæ™®é€šæ–‡æœ¬æ–‡ä»¶ä¸æ˜¾ç¤º
" if has("autocmd")
"    autocmd FileType xml,html,c,cs,java,perl,shell,bash,cpp,python,vim,php,ruby set number
"    autocmd FileType xml,html vmap <C-o> <ESC>'<i<!--<ESC>o<ESC>'>o-->
"    autocmd FileType java,c,cpp,cs vmap <C-o> <ESC>'<o/*<ESC>'>o*/
"    autocmd FileType html,text,php,vim,c,java,xml,bash,shell,perl,python setlocal textwidth=100
"    autocmd Filetype html,xml,xsl source $VIMRUNTIME/plugin/closetag.vim
"    autocmd BufReadPost *
"       \ if line("'\"") > 0 && line("'\"") <= line("$") |
"       \   exe "normal g`\"" |
"       \ endif
" endif " has("autocmd")

" èƒ½å¤Ÿæ¼‚äº®åœ°æ˜¾ç¤º.NFOæ–‡ä»¶
set encoding=utf-8
function! SetFileEncodings(encodings)
    let b:myfileencodingsbak=&fileencodings
    let &fileencodings=a:encodings
endfunction
function! RestoreFileEncodings()
    let &fileencodings=b:myfileencodingsbak
    unlet b:myfileencodingsbak
endfunction

au BufReadPre *.nfo call SetFileEncodings('cp437')|set ambiwidth=single
au BufReadPost *.nfo call RestoreFileEncodings()

" ç”¨ç©ºæ ¼é”®æ¥å¼€å…³æŠ˜å 
set foldenable
set foldmethod=manual
nnoremap <space> @=((foldclosed(line('.')) < 0) ? 'zc' : 'zo')<CR>

" F2æ§åˆ¶èœå•æ å’Œå·¥å…·æ æ˜¾ç¤º
set guioptions-=m
set guioptions-=T
map <silent> <F2> :if &guioptions =~# 'T' <Bar>
        \set guioptions-=T <Bar>
        \set guioptions-=m <bar>
    \else <Bar>
        \set guioptions+=T <Bar>
        \set guioptions+=m <Bar>
    \endif<CR>

" airline settings
let g:airline_left_sep='â–¶'
let g:airline_right_sep='â—€'
if !exists('g:airline_symbols')
  let g:airline_symbols={}
endif
let g:airline_symbols.crypt='ğŸ”’'

let g:airline#extensions#whitespace#enabled=1

let g:airline#extensions#tabline#enabled=1
let g:airline#extensions#tabline#show_buffers=1
let g:airline#extensions#tabline#show_tabs=1
let g:airline#extensions#tabline#buffer_idx_mode=1
nmap <leader>1 <Plug>AirlineSelectTab1
nmap <leader>2 <Plug>AirlineSelectTab2
nmap <leader>3 <Plug>AirlineSelectTab3
nmap <leader>4 <Plug>AirlineSelectTab4
nmap <leader>5 <Plug>AirlineSelectTab5
nmap <leader>6 <Plug>AirlineSelectTab6
nmap <leader>7 <Plug>AirlineSelectTab7
nmap <leader>8 <Plug>AirlineSelectTab8
nmap <leader>9 <Plug>AirlineSelectTab9
let g:airline#extensions#tabline#buffer_nr_show=1
let g:airline#extensions#tabline#formatter='unique_tail_improved'

let g:airline_section_b=''
let g:airline_section_c='%F%m%r%h%w'

"set statusline=[%n]\ %F%m%r%h%w\ [%l/%L,%v][%p%%]%=[%{&ff}]\ [%Y]\ %{strftime(\"%b\ %d,\ %Y\ %H:%M\")}
